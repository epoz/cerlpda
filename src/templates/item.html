{% extends "base.html" %}

{% macro snip(field, title, text) %}
{% if field == 'INSTIT_CERLID' %}
    {% if text %}{% if title %}<span class="hed">{{title}}: </span>{% endif %}{{text|cerl_holdinst}}{% endif %}
{% else %}
    {% if text %}{% if title %}<span class="hed">{{title}}: </span>{% endif %}{{text|cerl_thesaurus}}{% endif %}
{% endif %}
{% endmacro %}



{% block title %}CERL PDA Â· {{obj["ID"][0]}}{% endblock title %}

{% block head_last%}
<script src="/static/openseadragon-2.4.2/openseadragon.min.js"></script>
<!--script type="module">import * as item from '/static/item/item.js';</script-->
<style>
.hed {font-variant: small-caps; color: #888; margin-right: 1ch}
.notespara {margin: 0}
</style>

{% endblock %}

{% block content %}
<div class="container-fluid" style="padding: 1vh 1vw 5vh 5vw;">
        <div class="row p-4">
            <div class="col">
                {% if request.user.is_admin or obj["UPLOADER"][0][0] == request.user.username %}
                <a class="btn btn-sm btn-info" href="/edit/{{obj['ID'][0]}}">Edit</a>{% endif %}
                {% if request.user.is_admin %}
                <a class="btn btn-sm btn-danger" href="#">Delete</a>{% endif %}                        
                <a class="btn btn-sm btn-secondary" href="#">Comment</a>
            </div>
            {% if "UPLOADER" in obj and request.user.is_admin %}
            <div class="col"><span class="hed">Uploaded by:</span>{{obj["UPLOADER"][0][1]}}</div>{% endif %}
            {% if "CANYOUHELP" in obj %}
            <div class="col"><a class="btn btn-sm btn-danger" href="/canyouhelp">This item is in "Can You Help?"</a></div>
            {% endif %}
            {% if request.user.is_admin %}
            <div class="col"><a class="btn btn-sm btn-secondary" href="/id/{{obj['ID'][0]}}.raw">Raw</a></div>
            {% endif %}
        </div>

    <div class="row" style="padding: 1vw 2vw 0 2vw">
        <div style="font-size: 150%">{{snip(*TF("OWNERS_CERLID"))}}</div>
        <div style="margin-bottom: 1vh">{{snip(*TF("TITLE"))}}</div>
        <div>{{snip(*TF("CAPTION"))}}</div>
        <div>{{snip(*TF("TEXT"))}}</div>
        <div>{{snip(*TF("PERSON_AUTHOR"))}} {{snip(*TF("IMPRINT"))}}</div>
        <div>{{snip(*TF("INSTIT_CERLID"))}} {{snip(*TF("SHELFMARK"))}}</div>
        <div>{{snip(*TF("LOCATION_ORIG_CERLID"))}}</div>        
        {% if obj["OWNERS"] %}<div><span class="hed">Former Owners:</span>{% for vv in obj["OWNERS"] %}
        {{vv}} {% if not loop.last %}, {% endif %}{% endfor %}</div>{% endif %}
        
        <div>{{snip(*TF("TYPE_INS"))}} {{snip(*TF("TECHNIQUE"))}} {{snip(*TF("PAGE"))}}</div>
        <div>{{snip(*TF("WIDTH"))}} {{snip(*TF("HEIGHT"))}}</div>

        {% if obj.get("IC", [])|length > 0 %}
        <div class="mt-2"><p class="hed" style="margin: 0">ICONCLASS</p>
         {% for obj in obj.get("IC", [])|ic %}
            {% if obj %}
            <p style="margin: 0"><a target="_ic" href="https://iconclass.org/{{obj.get('n')|urlencode}}">{{obj.get('n')}}</a> {{obj['txt']['en']}}</p>
            {% endif %}

        {% endfor %}</div>
        {% endif %}


        {% if obj["URL_WEBPAGE"] %}
        <div style="text-align: right">
        See:  <a href="{{obj["URL_WEBPAGE"][0]}}">{{obj["URL_WEBPAGE"][0]}}</a></div>
        {% endif %}
        {% if obj["NOTES"] %}
        <p class="hed" style="margin: 0">Notes:</p>
        <div style="margin-bottom: 3vh">{{obj["NOTES"][0]|to_paras}}</div>
        {% endif %}


        <div id="thedzi1" style="height: 60vh; width: 100%; margin: 0 auto; border-top: 4px solid #ddd;"></div>

    </div>

</div>

<script type="text/javascript">
async function doInits() {
    var viewer = OpenSeadragon({
        id: "thedzi1",
        prefixUrl: '/static/openseadragon-2.4.2/images/',
        showNavigator: false,
        showFullPageControl: true,
        showRotationControl: true,
        maxZoomPixelRatio: 999,
        tileSources: [ {% for animage in obj.get('URL_IMAGE', []) %}
        { x: {{loop.index*1000+100}}, y: 0, width: 1000,             
            tileSource: '/iiif/2/{{animage}}/info.json'} {% if not loop.last %},{% endif %}
        {% endfor %}],
    });
}

doInits()
</script>
{% endblock %}
